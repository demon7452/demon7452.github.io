---
layout: post
title: Nginx学习总结
category: 技术
tags: 
keywords: Nginx
description: Nginx学习总结
---
##Nginx学习总结
###定义
Nginx 是一款轻量级的 Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，其特点是占有内
存少，并发能力强。
###特性
* 处理静态文件，索引文件以及自动索引；打开文件描述符缓冲．
* 无缓存的反向代理加速，简单的负载均衡和容错．
* FastCGI，简单的负载均衡和容错．
* 模块化的结构。包括 gzipping, byte ranges, chunked responses,以及 SSI-filter 等 filter。如果由 FastCGI 或其它代理服务器处理单页中存在的多个 SSI，则这项处理可以并行运行，而不需要相互等待。
* 支持 SSL 和 TLSSNI．

###Nginx 的进程模型图

![Nginx 的进程模型](http://tengine.taobao.org/book/_images/chapter-2-1.PNG)
####简要说明：
- 操作 Nginx:如上图所示，Nginx通过master进程来管理worker进程，所以我们只需要与master进程通信就行了。master 进程会接收来自外界发来的信号，再根据信号做不同的事情。
    - 通过 kill 向 master 进程发送信号。 
    - kill -HUP pid ，从容地重启Nginx；我们一般用这个信号来重启Nginx，或重新加载配置，重启过程中服务是不中断的。
    - master 进程在接收到 HUP 信号后是怎么做的呢？首先 master 进程在接到信号后，会先重新加
载配置文件，然后再启动新的 worker 进程，并向所有老的 worker 进程发送信号，告诉他们可以光荣退休
了。新的 worker 在启动后，就开始接收新的请求，而老的 worker 在收到来自 master 的信号后，就不再接收
新的请求，并且在当前进程中的所有未处理完的请求处理完成后，再退出。
    - Nginx 在 0.8 版本之后，引入了一系列命令行参数，来方便我们管理。比如， ./ngi
nx -s reload ，就是来重启 Nginx， ./nginx -s stop ，就是来停止 Nginx 的运行。
- worker 进程如何处理请求：
    - worker 进程之间是平等的，每个进程，处理请求的机会也是一样的。
    - 每个 worker 进程都是从 master 进程 fork 过来，在 master 进程里面，先建立好需要 listen 的 socket（listenfd）之后，然后再 fork 出多个 worker 进程。
    - 所有 worker 进程的 listenfd 会在新连接到来时变得可读，为保证只有一个进程处理该连接，所有 worker 进程在注册 listenfd 读事件前抢 accept_mutex，抢到互斥锁的那个进程注册listenfd 读事件，在读事件里调用 accept 接受该连接。
    - 当一个 worker 进程在accept这个连接之后，就开始读取请求，解析请求，处理请求，产生数据后，再返回给客户端，最后才断开连接。
    - 一个请求，完全由 worker 进程来处理，而且只在一个 worker 进程中处理。
- Nginx 采用这种进程模型的好处：
    - 首先，对于每个 worker进程来说，独立的进程，不需要加锁，所以省掉了锁带来的开销，同时在编程以及问题查找时，也会方便很多。
    - 其次，采用独立的进程，可以让进程互相之间不会影响，一个进程退出后，其它进程还在工作，服务不会中断，master进程则很快启动新的 worker 进程。


##参考文档
1.<a href="http://wiki.jikexueyuan.com/project/nginx/" target="_blank">Nginx 入门指南</a><br> 
2.<a href="https://github.com/taobao/nginx-book" target="_blank">taobao/nginx-book</a><br>
3.<a href="http://tengine.taobao.org/book/index.html" target="_blank">Nginx开发从入门到精通</a><br>
